<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Image Inserter</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container">
    <h1>Image Inserter</h1>

    <input type="text" id="image-url" placeholder="Enter image URL here">
    <button id="add-image">Add Image</button>

    <div id="image-gallery"></div>
</div>

<script>
const addImageBtn = document.getElementById('add-image');
const imageUrlInput = document.getElementById('image-url');
const imageGallery = document.getElementById('image-gallery');

let savedImages = JSON.parse(localStorage.getItem('savedImages')) || [];

// Load saved images
savedImages.forEach(url => createImageElement(url));

addImageBtn.addEventListener('click', () => {
    const url = imageUrlInput.value.trim();
    if (url) {
        createImageElement(url);
        savedImages.push(url);
        localStorage.setItem('savedImages', JSON.stringify(savedImages));
        imageUrlInput.value = '';
    }
});

function createImageElement(url) {
    const wrapper = document.createElement('div');
    wrapper.classList.add('image-card');

    const img = document.createElement('img');
    img.src = url;
    img.alt = "Inserted Image";

    // If image fails to load
    img.onerror = () => {
        alert("Image failed to load. The URL may be invalid or blocked.");
        wrapper.remove();
    };

    // Copy URL on click
    img.addEventListener('click', () => {
        navigator.clipboard.writeText(url)
            .then(() => alert("Image URL copied!"))
            .catch(() => alert("Failed to copy."));
    });

    // Download button (FIXED METHOD)
    const downloadBtn = document.createElement('button');
    downloadBtn.textContent = "Download";

    downloadBtn.addEventListener('click', async () => {
        try {
            const response = await fetch(url);
            const blob = await response.blob();
            const blobUrl = window.URL.createObjectURL(blob);

            const a = document.createElement('a');
            a.href = blobUrl;
            a.download = "image";
            document.body.appendChild(a);
            a.click();

            window.URL.revokeObjectURL(blobUrl);
            document.body.removeChild(a);
        } catch (error) {
            alert("Download failed. This image may be protected by CORS.");
        }
    });

    wrapper.appendChild(img);
    wrapper.appendChild(downloadBtn);
    imageGallery.appendChild(wrapper);
}
</script>

</body>
</html>
